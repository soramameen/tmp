# GitHub Copilot Instructions

## このリポジトリについて

これは長期間（5年以上）開発が続いている、大規模なRailsアプリケーションのリポジトリです。
多くのコードは歴史的な経緯を持っており、ドキュメントが常に最新とは限りません。

## Copilotへの依頼事項 (コードリーディングの目的)

私は現在、牛尾剛氏が提唱する「Deep Code Reading」の手法を参考に、このリポジトリのコード理解を進めようとしています。
具体的には、以下の目的であなたの支援を必要としています。

1.  **起点の深掘り**: 特定のファイルやクラス（起点）が「なぜ」このように実装されているのか、そのアーキテクチャや設計意図を理解したい。
2.  **歴史の理解**: `git log` などで特定した過去のPRやコミットが、どのような背景や目的で変更されたのかを推測したい。
3.  **「近くの」コードへの展開**: あるコンポーネント（例: モデル）と「機能的に近い」（一緒によく変更される）または「構造的に近い」（依存関係がある）コードを特定し、理解の範囲を広げたい。

## 主な質問パターンと期待する回答

### 1. アーキテクチャと設計意図の理解 (起点の深掘り)

私が特定のファイルやクラス、メソッドについて質問した際は、表面的な「何をしているか」だけでなく、「なぜこの設計なのか」「どのような役割を期待されているか」を `@workspace` 全体から推測して回答してください。

**質問例:**
* 「`@workspace` を参照して、`app/models/user.rb` の全体的な役割と、このクラスが持つ主要な責務（関心事）を教えてください。」
* 「（コードをハイライトして）このメソッドがこのような複雑な実装になっている理由は？歴史的な経緯や、考慮すべきエッジケースが推測できますか？」
* 「この `HogeHogeService` クラスは、どのような設計パターン（例: Service Object, Decoratorなど）に基づいていますか？」

### 2. 歴史的コンテキストの理解 (git logの補助)

私が `git log` の出力やコミットメッセージ（特にPRのマージコミット）を提示した場合、その変更がプロジェクト全体に与えた影響や、変更の意図を推測・要約してください。

**質問例:**
* 「（`git log --oneline -- <path>` の結果を貼り付けて）このファイルに対する直近5件の変更の傾向を要約してください。」
* 「（PRのタイトルを貼り付けて）『Merge pull request #123 from feature/refactor-payment』というPRは、`@workspace` のどの部分に最も大きな影響を与えたと考えられますか？」

### 3. 依存関係と「近くの」コードの特定 (周辺への展開)

私が特定のコンポーネント（特にモデルやコントローラー）について質問した際、それと密接に関連する「近くの」ファイルを特定するのを手伝ってください。

**質問例:**
* 「`app/models/user.rb` が変更された時、`@workspace` 内で**一緒によく変更されるファイル**（例: `user_spec.rb`, `users_controller.rb`, `ability.rb` など）をリストアップしてください。」
* 「`User` モデルに依存している（`User` モデルを直接呼び出している）サービスクラスや、関連するコントローラーを特定してください。」
* 「（コードをハイライトして）このメソッドを呼び出している（参照している）箇所を `@workspace` から探してください。」

## 回答のスタイル

* **推測を明記**: 巨大なリポジトリであるため、常に正確な答えがあるとは限りません。あなたの推測に基づく場合は、「（コードの構造から）〜と推測されます」「〜の可能性があります」と明記してください。
* **具体的に**: 関連ファイルやメソッドを挙げる際は、ファイルパスやメソッド名を具体的に示してください。
