# Deep Code Reading ワークフロー (巨大リポジトリ編)

このドキュメントは、長期間開発されている巨大なリポジトリにおいて、コードの歴史的背景とアーキテクチャを効率的に理解するための「Deep Code Reading」の実践的な手順をまとめたものです。

（参考: [ディープコードリーディングのすすめ](https://note.com/simplearchitect/n/n312c0e0e1a37)）

## ワークフローの全体像

全体を一度に理解しようとせず、**「起点（エントリーポイント）」**を決め、その**「歴史（土台）」**を深掘りし、そこから**「周辺（近く）」**へと理解を広げていきます。

---

### 📍 Phase 1: 準備 (起点（エントリーポイント）を決める)

まず、コードのどこを深く理解したいのか、調査の「起点」を明確にします。

- [ ] **調査の起点を決める**
  - 例1 (機能追加/修正): これから自分が作業するファイル（モデル、コントローラーなど）
  - 例2 (中核機能の理解): `User` モデルなど、サービスの根幹となるモデル
  - 例3 (バグ調査): バグが発生した箇所、または関連が疑われるモジュール

---

### 📜 Phase 2: 深掘り (起点の「歴史」を遡り、土台を理解する)

起点が「どのようにして現在の形になったのか」を、`git log` を使って遡ります。

- [ ] **起点の変更履歴（PR）を古い順にリストアップする**
  - ターミナルで以下のコマンドを実行します。（ブランチ名 `main` は適宜変更）
  - ```bash
    git log --merges --reverse --oneline main -- <Phase1で決めたファイルパス or ディレクトリパス>
    ```

- [ ] **「土台」となったPRを特定する**
  - リストの一番下（そのファイルが最初に追加されたPR）か、コミットメッセージから判断できる「大規模なリファクタリングPR」を見つけます。

- [ ] **「土台のPR」をGitHubで開き、"完全に理解"する**
  - **[重要]** このPRが、この記事のアーキテクチャの基礎です。時間をかけて読み解きます。
  - GitHub Copilot (`.github/copilot-instructions.md` を参照) を活用します。
    - 「このPRの主な目的は？」
    - 「このクラス（メソッド）の設計意図は？」
    - 「この設定ファイルはどこでどう使われる？」
  - PRの "Files changed" タブを見て、変更の全体像を把握します。
  - PRのディスカッション（レビューコメント）を読み、当時の背景を理解します。

---

### 🗺️ Phase 3: 展開 (「近く」のコードへ理解を広げる)

Phase 2で得たアーキテクチャの知識をベースに、関連するコードへと理解を広げます。

- [ ] **「機能的に近い」コードを把握する**
  - Phase 2で読んだ「土台のPR」で、**一緒に変更されていたファイル**を確認します。
  - （例: `User` モデルのPRなら、`user_spec.rb`, `UsersController`, `views/users/` などが「機能的に近い」コードです）

- [ ] **「構造的に近い」コードを把握する**
  - IDEの機能（「定義へ移動」「参照を検索」）を使います。
  - Copilotに質問します。
    - 「（起点のメソッドをハイライトし）このメソッドを呼び出している箇所を `@workspace` から探して」
    - 「`User` モデルに依存しているサービスクラスを `@workspace` から探して」

---

### 🚀 Phase 4: キャッチアップ (「現在地」を把握する)

「土台」を理解したら、そこから「現在」までの差分を高速にキャッチアップします。

- [ ] **起点の「最新の変更」をいくつか読む**
  - `git log` から `--reverse` を外して、最新のPRを上からいくつか確認します。
  - ```bash
    git log --merges --oneline main -- <Phase1で決めたファイルパス>
    ```
  - Phase 2で理解した「土台」との差分に着目すると、変更の意図が素早く理解できるはずです。

- [ ] **（オプション）他の開発者の最新PRを読む**
  - これが記事の本来の目的です。
  - リポジトリ全体の最新のPRをいくつか眺めてみます。
  - これまで学んだコンテキスト（土台＋周辺知識）があるため、差分を読むだけで「あ、これはあの機能の修正だな」と高速に理解できる状態を目指します。
